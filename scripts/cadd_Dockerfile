FROM debian:bookworm
RUN apt-get update && apt-get install -y procps wget tabix
RUN wget -q https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh && \
		bash Miniconda3-latest-Linux-x86_64.sh -b -p /opt/conda && \
		rm Miniconda3-latest-Linux-x86_64.sh
ENV PATH=/opt/conda/envs/cadd/bin:/opt/conda/bin:$PATH
RUN conda create -y -c bioconda -c conda-forge -n cadd cadd-scripts=1.6 mamba

# Run pipeline and fail; to create environments. It fails because the annotation data are
# not available - but this shouldn't be there anyway, nobody wants a 200 GB singularity image.
RUN cadd.sh -g GRCh38 -o /dev/null /opt/conda/envs/cadd/share/cadd-scripts-1.6-1/test/input.vcf || echo "Expected failure (look in the middle of the output): EXCEPTION / Cache directory /opt/conda/envs/cadd/share/cadd-scripts-1.6-1/data/annotations/GRCh38_v1.6/vep/homo_sapiens not found"

